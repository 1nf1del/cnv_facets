sudo: false
language: bash
dist: trusty

before_install:
    - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9 # To enable cran.r-project.org
    - echo 'deb http://cran.r-project.org/bin/linux/ubuntu trusty/' | sudo tee -a /etc/apt/sources.list
    - sudo apt-get -y update
    - sudo apt-get -y install r-base
    - mkdir -p ~/R/library && echo '.libPaths(c("~/R/library", .libPaths()))' >> ~/.Rprofile # Pick a writable dir for R packages

install:
    - bash setup.sh --help
    - bash setup.sh
    - bash setup.sh # Running again should do nothing

script:
    - bash setup.sh -b foo/bar 2> err.log || true && grep --silent 'Error' err.log && rm err.log
    - cd test && bash test.sh
